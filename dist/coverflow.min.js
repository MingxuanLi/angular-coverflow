"use strict";angular.module("angular-coverflow",[]),angular.module("angular-coverflow").directive("coverflow",["covers",function(a){return{restrict:"E",replace:!0,template:'<div class="coverflow-container"></div>',scope:{coverflow:"="},link:function(b,c){b.coverflow=new Coverflow({width:568,height:320,element:c,scope:b,images:a.all()}).init(),c.bind("touchstart",b.coverflow.touchStart.bind(b.coverflow)),c.bind("touchmove",b.coverflow.touchMove.bind(b.coverflow)),c.bind("touchend",b.coverflow.touchEnd.bind(b.coverflow))}}}]),window.requestAnimFrame=function(){return window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||function(a){window.setTimeout(a,1e3/60)}}();var Cover=function(a){this.coverId=a.id,this.positionId=a.id,this.flow=a.flow,this.image=a.image,this.size=a.size,this.frame=this.size-this.size/12,this.x=0,this.y=this.flow.height/2-this.size/2,this.rotation=0,this.scale=1,this.element=null,this.imageElement=null,this.overflow=0,this.lastPositionIndex=this.flow.positionIndex};Cover.prototype.init=function(){return this.flow.container.append(this.template()),this.element=document.getElementById("coverflow-cover-"+this.coverId),this.updateCover(this.image),this},Cover.prototype.template=function(){var a=document.createElement("div");return a.className="coverflow-cover",a.id="coverflow-cover-"+this.coverId,a},Cover.prototype.center=function(){return this.x+this.size/2},Cover.prototype.updateCover=function(a){this.image=a,this.element.style.backgroundImage="url('"+this.image+"')"},Cover.prototype.applyNextStyle=function(){this.element.style["-webkit-transform"]="translate3d("+this.x+"px, "+this.y+"px, 0px) rotateY("+this.rotation+"deg) scale3d("+this.scale+", "+this.scale+", 1)"},Cover.prototype.calculateNextStyle=function(){this.x=this.nextCoverX(),this.rotation=this.nextRotation(),this.scale=this.nextScale()},Cover.prototype.animateFrame=function(){this.calculateNextStyle(),this.applyNextStyle()},Cover.prototype.overflowAt=function(a){var b=this.overflow+a,c=(this.positionId,this.coverId-this.flow.totalCovers*b);if(this.flow.images){if(0>c)return;if(c>this.flow.totalImages-1)return}this.overflow=b,this.positionId=c,this.flow.images&&this.updateCover(this.flow.images[this.positionId])},Cover.prototype.nextCoverX=function(){var a=this.flow.visibleCovers*this.frame,b=this.flow.position+this.positionId*this.frame;return b>a&&this.overflowAt(1),b<-this.frame&&this.overflowAt(-1),this.flow.position+this.positionId*this.frame},Cover.prototype.nextRotation=function(){var a=this.flow.center-this.center(),b=this.center()<this.flow.center?1:-1,c=Math.abs(a/this.flow.center);return c=4*c*c,c>1&&(c=1),0+b*c*this.flow.maxRotation},Cover.prototype.nextScale=function(){return(1-Math.abs(this.rotation/this.flow.maxRotation)+5)/6};var Coverflow=function(a){this.width=a.width,this.height=a.height,this.images=a.images,this.center=this.width/2,this.scope=a.scope,this.totalCovers=4,this.visibleCovers=3,this.centerIndex=Math.ceil(this.visibleCovers/2),this.covers=[],this.cache=[],this.totalImages=0,this.touch={},this.container=a.element,this.velocity=0,this.easing=1.05,this.position=0,this.maxRotation=60,this.positionLimitLeft=+1/0,this.positionLimitRight=-1/0,this.lastPositionIndex=0,this.positionIndex=0};Coverflow.prototype.init=function(){for(var a=0;a<this.totalCovers;a++)this.covers[a]=new Cover({id:a,image:"cover.png",size:200,flow:this}).init();if(this.images){this.totalImages=this.images.length,this.positionLimitLeft=(this.centerIndex-1)*this.covers[0].frame,this.positionLimitRight=-(this.totalImages-1-(this.centerIndex-1))*this.covers[0].frame;for(var a=0;a<this.totalCovers;a++)this.covers[a].updateCover(this.images[a])}return this.animateFrame(),this},Coverflow.prototype.animateFrame=function(){var a=this;requestAnimFrame(function(){a.scope.$apply(a.animateFrame.bind(a))}),this.velocity=this.nextVelocity(),this.position=this.nextPosition(),this.positionIndex=this.currentPositionIndex();for(var b=0;b<this.totalCovers;b++)this.covers[b].animateFrame()},Coverflow.prototype.nextVelocity=function(){return this.velocity<=1&&this.velocity>=-1?0:this.velocity/this.easing},Coverflow.prototype.nextPosition=function(){var a=this.position+this.velocity;return a>=this.positionLimitLeft?(this.velocity=0,this.positionLimitLeft):a<=this.positionLimitRight?(this.velocity=0,this.positionLimitRight):a},Coverflow.prototype.currentPositionIndex=function(){var a=Math.floor(-this.position/this.covers[0].frame)+this.centerIndex;return a!=this.lastPositionIndex&&(this.positionIndex=a,this.lastPositionIndex=a),a},Coverflow.prototype.coverForPositionIndex=function(a){for(var b=0;b<this.totalCovers;b++)if(this.covers[b].positionId==a-1)return this.covers[b]},Coverflow.prototype.touchStart=function(a){a.preventDefault(),this.velocity=0,this.touch.start=a.changedTouches[0].pageX},Coverflow.prototype.touchMove=function(a){a.preventDefault();var b=a.changedTouches[0].pageX,c=this.touch.start-b;this.position-=c,this.velocity-=c/4,this.touch.start=b},Coverflow.prototype.touchEnd=function(a){a.preventDefault()},angular.module("angular-coverflow").service("covers",function(){var a=this;this.preloaded=!1,this.images=["covers/1.jpg","covers/2.jpg","covers/3.jpg","covers/4.jpg","covers/5.jpg","covers/6.jpg","covers/7.jpg","covers/8.jpg","covers/9.jpg","covers/10.jpg","covers/11.jpg","covers/12.jpg","covers/13.jpg","covers/14.jpg","covers/15.jpg","covers/16.jpg","covers/17.jpg","covers/18.jpg","covers/19.jpg","covers/20.jpg"],this.all=function(){return a.preload(),a.images},this.preload=function(){if(!a.preloaded){for(var b=this.images.length,c=0;b>c;c++){var d=new Image;d.src=a.images[c]}a.preloaded=!0}}});